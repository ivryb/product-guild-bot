import { InlineKeyboard } from 'grammy';

import { setIntroStatus } from '../session.js';

import { botName, botNameC } from '../store/script.js';
import { getRankName } from '../store/ranks.js';

export const setupWelcomeStage = (bot) => {
  const getWelcomeKeyboard = (ctx) => {
    const { guild, pms } = ctx.session.introStatus;

    let keyboard = new InlineKeyboard();

    if (!guild) {
      keyboard.text('üí≠ –†–æ–∑–∫–∞–∂–∏ –ø—Ä–æ "–ì—ñ–ª—å–¥—ñ—é"', 'welcomeAboutGuild').row();
    }

    if (!pms) {
      keyboard.text('üí≠ –•—Ç–æ —Ç–∞–∫—ñ "–ü—Ä–æ–¥–∞–∫—Ç-–ú–µ–Ω–µ–¥–∂–µ—Ä–∏"?', 'welcomeAboutPMs').row();
    }

    if (guild && pms) {
      keyboard.text('üí≠ –¶—ñ–∫–∞–≤–æ...', 'welcomeEnd').row();
    }

    return keyboard;
  }

  bot.command('start', async (ctx) => {
    await ctx.reply(`–í—ñ—Ç–∞—é, –¥—Ä—É–∂–µ! –õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ <b>–ì—ñ–ª—å–¥—ñ—ó –ü—Ä–æ–¥–∞–∫—Ç-–ú–µ–Ω–µ–¥–∂–µ—Ä—ñ–≤!</b>\n\n–ú–µ–Ω–µ –∑–≤–∞—Ç–∏ ${botName}, —è –±—É–¥—É —Ç–≤–æ—ó–º –ø—Ä–æ–≤—ñ–¥–Ω–∏–∫–æ–º —É —Å–≤—ñ—Ç—ñ –∑–∞–ø—É—Å–∫—É —Å—Ç–∞—Ä—Ç–∞–ø—ñ–≤, –∞ –∑ —á–∞—Å–æ–º ‚Äî –º–æ–∂–ª–∏–≤–æ –π –≤—ñ—Ä–Ω–∏–º —Å–æ—é–∑–Ω–∏–∫–æ–º.`, {
      reply_markup: getWelcomeKeyboard(ctx)
    });
  });

  bot.callbackQuery('welcomeAboutPMs', async (ctx) => {
    setIntroStatus(ctx, 'pms');

    await ctx.reply(`${botNameC} –ü—Ä–æ–¥–∞–∫—Ç-–ú–µ–Ω–µ–¥–∂–µ—Ä–∏ ‚Äî —Ü–µ –ª—é–¥–∏, –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ –∑–∞ —Ä–æ–∑–≤–∏—Ç–æ–∫ –ü—Ä–æ–¥—É–∫—Ç—ñ–≤. –¶–µ –æ–¥–Ω–∞ –∑ –Ω–∞–π—Ü—ñ–∫–∞–≤—ñ—à–∏—Ö —Ç–∞ –Ω–∞–π—Å–∫–ª–∞–¥–Ω—ñ—à–∏—Ö –ø—Ä–æ—Ñ–µ—Å—ñ–π —Å—å–æ–≥–æ–¥–µ–Ω–Ω—è. –ü—Ä–æ–¥–∞–∫—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä–∏ —î –≤ Google, Netflix, Uklon —Ç–∞ Megogo ‚Äî —Å–ª–æ–≤–æ–º, —É –≤—Å—ñ—Ö –∫–æ–º–ø–∞–Ω—ñ—è—Ö, —è–∫—ñ —Å—Ç–≤–æ—Ä—é—é—Ç—å –∫–æ—Ä–∏—Å–Ω—ñ –ø—Ä–æ–¥—É–∫—Ç–∏ —Ç–∞ —Å–µ—Ä–≤—ñ—Å–∏. –°–∞–º–µ —Ü—ñ –ª—é–¥–∏ –ø—Ä–∏–π–º–∞—é—Ç—å —Ä—ñ—à–µ–Ω–Ω—è —è–∫—ñ –Ω–æ–≤—ñ –ø—Ä–æ–¥—É–∫—Ç–∏ —Ç—Ä–µ–±–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–∏, —ñ —è–∫ —Å–∞–º–µ –æ–Ω–æ–≤–∏—Ç–∏ —ñ—Å–Ω—É—é—á—ñ, —â–æ–± –ø–æ–∫—Ä–∞—â–∏—Ç–∏ –∂–∏—Ç—Ç—è –º—ñ–ª—å–π–æ–Ω—ñ–≤ –ª—é–¥–µ–π. –°–∞–º–µ –ü—Ä–æ–¥–∞–∫—Ç-–ú–µ–Ω–µ–¥–∂–µ—Ä–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ –∑–∞ —Ç–µ, —è–∫–∏–º —Å—Ç–∞–Ω–µ —Å–≤—ñ—Ç...`, {
      reply_markup: getWelcomeKeyboard(ctx)
    });

    await ctx.answerCallbackQuery();
  });

  bot.callbackQuery('welcomeAboutGuild', async (ctx) => {
    setIntroStatus(ctx, 'guild');

    await ctx.reply(`${botNameC} –ì—ñ–ª—å–¥—ñ—è –±—É–ª–∞ —Å—Ç–≤–æ—Ä–µ–Ω–∞ <b>–ú–∞–π—Å—Ç—Ä–∞–º–∏ –ü—Ä–æ–¥–∞–∫—Ç-–ú–µ–Ω–µ–¥–∂–º–µ–Ω—Ç—É</b>, —â–æ–± –ø–æ–ø—É–ª—è—Ä–∏–∑—É–≤–∞—Ç–∏ —Ü–µ —Ä–µ–º–µ—Å–ª–æ —Ç–∞ –¥–æ–ø–æ–º–∞–≥–∞—Ç–∏ –Ω–æ–≤–∞—á–∫–∞–º –∑–∞–ø—É—Å–∫–∞—Ç–∏ –≤–ª–∞—Å–Ω—ñ –ø—Ä–æ—î–∫—Ç–∏.\n\n–£ –ì—ñ–ª—å–¥—ñ—ó –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –∑–Ω–∞–Ω–Ω—è, –≤—ñ–¥–Ω–∞–π–¥–µ–Ω—ñ –¥–µ—Å—è—Ç–∫–∞–º–∏ –ø–æ–∫–æ–ª—ñ–Ω—å –ú–∞–π—Å—Ç—Ä—ñ–≤ —Ç–∞ –≤–∏–ø—Ä–æ–±—É–≤–∞–Ω—ñ –Ω–∞ —Å–æ—Ç–Ω—è—Ö –ø—Ä–æ—î–∫—Ç—ñ–≤.\n\n–£—á–∞—Å–Ω–∏–∫–∏ –≥—ñ–ª—å–¥—ñ—ó –æ–±'—î–¥–Ω—É—é—Ç—å—Å—è —á–µ—Ä–µ–∑ —á–∞—Ç–∏ —Ç–∞ —Ä—ñ–∑–Ω–æ–º–∞–Ω—ñ—Ç–Ω—ñ –∑—É—Å—Ç—Ä—ñ—á—ñ, –∞ –ø–æ–ª–æ–∂–µ–Ω–Ω—è –∑–∞—Å–ª—É–≥–æ–≤—É—î—Ç—å—Å—è –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è–º–∏ —É –ü—Ä–æ–¥–∞–∫—Ç-–ú–µ–Ω–µ–¥–∂–º–µ–Ω—Ç—ñ.`, {
      reply_markup: getWelcomeKeyboard(ctx)
    });

    await ctx.answerCallbackQuery();
  });

  bot.callbackQuery('welcomeEnd', async (ctx) => {
    await ctx.reply(`${botNameC} –Ø–∫—â–æ —Ç–æ–±—ñ —Ü—ñ–∫–∞–≤–æ, –º–æ–∂–µ—à —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –≤—Å—Ç—É–ø–∏—Ç–∏ –¥–æ –ì—ñ–ª—å–¥—ñ—ó. –î–ª—è —Ü—å–æ–≥–æ —Ç—Ä–µ–±–∞ –±—É–¥–µ –≤–∏–∫–æ–Ω–∞—Ç–∏ 2 –Ω–µ–≤–µ–ª–∏–∫–∏—Ö –∑–∞–≤–¥–∞–Ω–Ω—è. –ì–æ—Ç–æ–≤–∏–π?`, {
      reply_markup: new InlineKeyboard()
        .text('‚ú® –î–æ–ª—É—á–∏—Ç–∏—Å—è –¥–æ –ì—ñ–ª—å–¥—ñ—ó', 'startGuildJoining').row()
    })

    await ctx.answerCallbackQuery();
  });
}